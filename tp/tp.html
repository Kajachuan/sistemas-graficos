<!doctype html>
<meta content="text/html;charset=UTF-8" http-equiv="Content-Type">
<html>
  <head>
    <title>TP Sistemas Gr치ficos</title>
    <style>
      body{ background-color: grey; }
      canvas{ background-color: white; }
      textarea{ background-color: black; foreground-color: white; }
    </style>

    <script type="text/javascript" src="js/gl-matrix.js"></script>
    <script type="text/javascript" src="js/dat.gui.min.js"></script>
    <script type="text/javascript" src="camera/CameraHandler.js"></script>
    <script type="text/javascript" src="menu/menu.js"></script>


    <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 VertexPosition;
      attribute vec3 VertexNormal;
      attribute vec2 VertexTexCoord;

      uniform mat4 ModelMatrix;
      uniform mat4 ViewMatrix;
      uniform mat4 ProjectionMatrix;
      uniform mat3 NormalMatrix;

      varying vec2 TexCoord;
      varying vec3 Normal;
      varying vec4 EyeCoords;
      varying vec2 ReflectDir;

      void main(void) {
        TexCoord = VertexTexCoord;
        Normal = normalize(NormalMatrix * VertexNormal);
        EyeCoords = ViewMatrix * ModelMatrix * vec4(VertexPosition, 1.0);
        vec3 r = reflect(vec3(EyeCoords), Normal);
        float m = 2.0 * sqrt(pow(r.x, 2.0) + pow(r.y, 2.0) + pow(r.z + 1.0, 2.0));
        ReflectDir = r.xy / m + 0.5;

        gl_Position = ProjectionMatrix * EyeCoords;
      }
    </script>

    <script id="shader-fs" type="x-shader/x-fragment">
      precision mediump float;

      uniform bool UseDiffuseMap;
      uniform bool UseReflectMap;
      uniform sampler2D DiffuseMap;
      uniform sampler2D ReflectMap;

      struct LightInfo {
        vec4 LightPosition;
        vec3 Intensity;
      };
      uniform LightInfo Lights[9];

      struct MaterialInfo{
        vec3 Ka;
        vec3 Kd;
        vec3 Ks;
        float Glossiness;
      };
      uniform MaterialInfo Material;

      varying vec2 TexCoord;
      varying vec3 Normal;
      varying vec4 EyeCoords;
      varying vec2 ReflectDir;

      void main(void) {
        vec4 texColor = texture2D(DiffuseMap, TexCoord);
        vec4 reflectColor = texture2D(ReflectMap, ReflectDir);

        vec3 ambient = vec3(0.0);
        vec3 diffuse = vec3(0.0);
        vec3 specular = vec3(0.0);
        vec3 diffColor = UseDiffuseMap ? texColor.rgb : Material.Kd;
        vec3 v = normalize(-EyeCoords.xyz);
        vec3 specularColor = UseReflectMap ? reflectColor.rgb : Material.Ks;

        for(int i = 0; i < 9; i++) {
          vec3 l = normalize(vec3(Lights[i].LightPosition - EyeCoords));
          vec3 r = reflect(-l, Normal);
          ambient += Lights[i].Intensity * Material.Ka;
          float lambertian = max(dot(l, Normal), 0.0);
          diffuse += Lights[i].Intensity * diffColor * lambertian;

          if(lambertian > 0.0)
            specular += Lights[i].Intensity * specularColor * pow(max(dot(r, v), 0.0), Material.Glossiness);
        }

        gl_FragColor = vec4(ambient + diffuse + specular, 1.0);
      }
    </script>

    <script type="text/javascript" src="script.js"></script>
  </head>
  <body onload="initWebGL()" id="my-body">
    <center>
      <h1>Trabajo Pr치ctico - Sistemas Gr치ficos</h1>
      <h2>Kevin Cajachu치n - 98.725 | Fabrizio Cozza - 97.402</h2>
      <canvas id="my-canvas" width="900" height="500">
        Your browser does not support the HTML5 canvas element.
      </scanvas>
    </center>
  </body>
</html>
