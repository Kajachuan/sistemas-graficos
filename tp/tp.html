<!doctype html>
<meta content="text/html;charset=UTF-8" http-equiv="Content-Type">
<html>
  <head>
    <title>TP Sistemas Gráficos</title>
    <style>
      body{ background-color: grey; }
      canvas{ background-color: white; }
      textarea{ background-color: black; foreground-color: white; }
    </style>

    <script type="text/javascript" src="gl-matrix.js"> // Librería GL-MATRIX </script>

    <!--
    Vertex shader

    El vertex shader define la posición y forma de cada vertice de cada polígono.
    -->
    <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 aVertexPosition;
      attribute vec3 aVertexNormal;

      uniform mat4 uMMatrix;
      uniform mat4 uVMatrix;
      uniform mat4 uPMatrix;
      uniform mat3 uNMatrix;
      uniform vec3 uAmbientColor;
      uniform vec3 uLightPosition;
      uniform vec3 uDirectionalColor;
      uniform bool uUseLighting;

      varying vec3 vLightWeighting;
      varying vec3 vColor;

      void main(void) {
        // Transformamos al vértice al espacio de la cámara
        vec4 pos_camera_view = uVMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
        gl_Position = uPMatrix * pos_camera_view;

        // Cálculos de la iluminación
        vec3 light_dir = uLightPosition - vec3(pos_camera_view);
        normalize(light_dir);
        if(!uUseLighting) {
          vLightWeighting = vec3(1.0, 1.0, 1.0);
        }
        else {
          vec3 transformedNormal = normalize(uNMatrix * aVertexNormal);
          float directionalLightWeighting = max(dot(transformedNormal, light_dir), 0.0);
          vLightWeighting = uAmbientColor * uDirectionalColor * directionalLightWeighting;
          //normalize(vLightWeighting);
        }
      }
    </script>

    <!--
    Fragment shader

    Cada pixel en un polígono se llama fragmento. El fragment shader se encarga de
    establecer el color de cada pixel. En este caso, asignamos el color blanco a
    cada pixel.
    -->
    <script id="shader-fs" type="x-shader/x-fragment">
      precision mediump float;

      varying vec3 vLightWeighting;

      void main(void) {
        // gl_FragColor es una variable "built-in" de GLSL que es usada para
        // almacenar el color resultante del fragmento.
        gl_FragColor = vec4(vLightWeighting, 1.0); // Revisar esto
      }
    </script>

    <script type="text/javascript" src="script.js"></script>
  </head>
  <body onload="initWebGL()">
    <center>
      <h1>Trabajo Práctico - Sistemas Gráficos</h1>
      <h2>Nombres</h2>
      <canvas id="my-canvas" width="900" height="500">
        Your browser does not support the HTML5 canvas element.
      </scanvas>
    </center>
  </body>
</html>
